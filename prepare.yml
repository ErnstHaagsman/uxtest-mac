---
- hosts: localhost
  become: no
  vars:
    user: pyconde
    workdir: "/Users/{{ user }}/Documents/scripts"
    code_checkout: "{{ workdir }}/code"
    code_desktop: "/Users/{{ user }}/Desktop/code"
    product_dir: "PyCharm2017.3"
  tasks:
    - name: Get the code from GitHub
      git:
        repo: https://github.com/ErnstHaagsman/selenium_experiment.git
        dest: "{{ code_checkout }}"
        update: yes
        version: bugs
        force: yes

    - name: Get python user base
      shell: python -m site --user-base
      register: user_base_output

    - set_fact:
        user_base: "{{ user_base_output.stdout }}"

    - name: Template profile
      template:
        src: templates/.profile
        dest: "/Users/{{ user }}/.profile"

    - name: Update setuptools
      pip:
        name: setuptools
        state: latest
        extra_args: --user

    - name: Install devpi
      pip:
        name: devpi-server
        extra_args: --user

    - name: Start devpi
      command: devpi-server --start
      environment:
        PATH: "{{ user_base }}/bin:{{ ansible_env.PATH }}"

